<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>List Users</title>
    <script src="jquery.js"></script>
    <script>
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function getSessionId() {
        var sessionId=getParameterByName("sessionId");
        $('#sessionId').val(sessionId)
    }

    function getList() {
        getSessionId()
        $.post("/users/list", populateList)
    }

    function populateList (data, status) {
        var userList = JSON.parse(data);
        var i;
        for (i = 0; i < userList.userList.length; i++) {
            var newHtml = '<li>' + userList.userList[i].name
            + ' <a href="editUser.html?name=' + userList.userList[i].name + '">edit</a> '
            + ' <button onclick="removeUser(\'' + userList.userList[i].name + '\')">delete</button>'
            $('#users').append (newHtml)
        }
    }

    function removeUser(name) {
        if (confirm("Please confirm the delete of " + name)) {
            var userRequest = new Object()
            userRequest = { user: name }
            var json = JSON.stringify (userRequest)
            $.post("/users/delete", json, userRemoved)
        }
    }

    function userRemoved (data,textStatus, jqXHR) {
        window.location.reload();
    }
</script>
</head>
<body onload="getList()">
sessionId is <input type="text" name="sessionId" id="sessionId" size="32">
<br/>
<div id=>
    <ul id="users">

    </ul>
</div>
<button onclick="add()">Create</button>
<br/>
</body>
</html>
<script>
    function add() {
        window.location.href = "createUser.html";
    }
</script>
